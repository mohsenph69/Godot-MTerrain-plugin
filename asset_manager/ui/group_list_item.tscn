[gd_scene load_steps=5 format=3 uid="uid://cm13sxqgb7lo6"]

[ext_resource type="Theme" uid="uid://b3bd1lceed8ec" path="res://addons/m_terrain/gui/styles/mterrain_gui_theme.tres" id="1_7mm5u"]
[ext_resource type="Texture2D" uid="uid://s6jqtql0r2bw" path="res://addons/m_terrain/icons/edit_icon.svg" id="2_bgatm"]
[ext_resource type="Texture2D" uid="uid://t8tdan3853oy" path="res://addons/m_terrain/icons/icon_close.svg" id="3_k4dh7"]

[sub_resource type="GDScript" id="GDScript_q14g1"]
script/source = "@tool
extends PanelContainer

signal group_removed
signal group_renamed
signal group_selected

@onready var line_edit:LineEdit = find_child(\"LineEdit\")

var current_name
var tags = []

var selected = false

func _ready():	
	$HBoxContainer/remove.pressed.connect(func():
		group_removed.emit(current_name)
		queue_free()
	)
	$HBoxContainer/rename.pressed.connect(func():		
		for child in get_parent().get_children():			
			child.toggle_editing(child == self)			
	)
	line_edit.text_submitted.connect(func(new_text):		
		toggle_editing(false)
		group_renamed.emit(current_name, new_text)		
		current_name = new_text
	)
	line_edit.gui_input.connect(func(event):
		if line_edit.editable == false and event is InputEventMouseButton and event.pressed:
			line_edit.release_focus()			
			item_clicked()
	)
	line_edit.draw.connect(draw)
	

func toggle_editing(toggle_on):
	line_edit.editable = toggle_on
	if toggle_on:
		line_edit.grab_focus()
		line_edit.mouse_default_cursor_shape = CursorShape.CURSOR_IBEAM
	else:
		line_edit.mouse_default_cursor_shape = CursorShape.CURSOR_POINTING_HAND
	
func set_group_name(text):
	line_edit.text = text
	current_name = text

func item_clicked():
	for child in get_parent().get_children():	
		child.selected = child == self
		child.update_selection()
		child.toggle_editing(false)
	group_selected.emit(current_name)
	
func _gui_input(event: InputEvent):
	if event is InputEventMouseButton and event.pressed:		
		item_clicked()	

func draw():
	if selected:
		line_edit.draw_style_box(preload(\"res://addons/m_terrain/gui/styles/stylebox_selected.tres\"), Rect2(Vector2(0,0), size))

func update_selection():
	line_edit.queue_redraw()	
"

[node name="GroupListItem" type="PanelContainer"]
custom_minimum_size = Vector2(0, 36)
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
theme = ExtResource("1_7mm5u")
script = SubResource("GDScript_q14g1")

[node name="HBoxContainer" type="HBoxContainer" parent="."]
layout_mode = 2

[node name="LineEdit" type="LineEdit" parent="HBoxContainer"]
layout_mode = 2
size_flags_horizontal = 3
size_flags_vertical = 4
mouse_filter = 1
mouse_default_cursor_shape = 2
text = "GROUP NAME"
editable = false
expand_to_text_length = true

[node name="rename" type="Button" parent="HBoxContainer"]
custom_minimum_size = Vector2(32, 32)
layout_mode = 2
mouse_filter = 1
theme_type_variation = &"button_icon_only"
icon = ExtResource("2_bgatm")
expand_icon = true

[node name="remove" type="Button" parent="HBoxContainer"]
custom_minimum_size = Vector2(32, 32)
layout_mode = 2
mouse_filter = 1
theme_type_variation = &"button_icon_only"
icon = ExtResource("3_k4dh7")
expand_icon = true
